<section layout="row" layout-wrap layout-padding class="page-header">
  <h4>
    Stats
  </h4>
</section>

<section class="container" ng-cloak>
  <div layout="column" layout-padding>
    <h5 class="no-margin">Combat</h5>
  </div>
  <md-card>
    <md-card-content>
      <div layout="row" layout-wrap>
        <!--Proficiency Bonus-->
        <div flex="25" flex-sm="50" flex-xs="100" layout="row">
          <md-input-container ng-if="$ctrl.character.proficiencyBonusLock" flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <label>Proficiency Bonus</label>
            <input type="number" ng-model="$ctrl.character.proficiencyBonus" disabled
            ng-change="$ctrl.updateCharacter('', 'proficiencyBonus', $ctrl.character.proficiencyBonus);">
            <md-tooltip md-direction="bottom">
              Level {{$ctrl.character.level}}
            </md-tooltip>
          </md-input-container>
          <md-input-container ng-if="!$ctrl.character.proficiencyBonusLock" flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <label>Proficiency Bonus</label>
            <input type="number" ng-model="$ctrl.character.proficiencyBonus"
            ng-change="$ctrl.updateCharacter('', 'proficiencyBonus', $ctrl.character.proficiencyBonus);">
          </md-input-container>
          <md-input-container flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <md-checkbox aria-label="Checkbox 1" class="md-primary inline-checkbox"
            ng-model="$ctrl.character.proficiencyBonusLock"
            ng-change="$ctrl.updateCharacter('', 'proficiencyBonusLock', $ctrl.character.proficiencyBonusLock); $ctrl.character.proficiencyBonus = $ctrl.getProficiencyBonus($ctrl.character.level);">
              <md-icon class="material-icons">
                <span ng-if="$ctrl.character.proficiencyBonusLock">
                  lock
                </span>
                <span ng-if="!$ctrl.character.proficiencyBonusLock">
                  lock_open
                </span>                
              </md-icon>              
            </md-checkbox>
          </md-input-container>
        </div>

        <!--Armor Class-->
        <md-input-container flex="25" flex-sm="50" flex-xs="100" class="md-no-error-spacer">
          <label>Armor Class</label>
          <input type="number" ng-model="$ctrl.character.armorClass"
          ng-change="$ctrl.updateCharacter('', 'armorClass', $ctrl.character.armorClass);">
        </md-input-container>

        <!--Initiative-->
        <div flex="25" flex-sm="50" flex-xs="100" layout="row">
          <md-input-container ng-if="$ctrl.character.initiativeLock" flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <label>Initiative</label>
            <input type="number" ng-model="$ctrl.character.initiative" disabled
            ng-change="$ctrl.updateCharacter('', 'initiative', $ctrl.character.initiative);">
            <md-tooltip md-direction="bottom">
              Dex Modifier
            </md-tooltip>
          </md-input-container>
          <md-input-container ng-if="!$ctrl.character.initiativeLock" flex="50" flex-sm="50" flex-xs="100" class="md-no-error-spacer">
            <label>Initiative</label>
            <input type="number" ng-model="$ctrl.character.initiative"
            ng-change="$ctrl.updateCharacter('', 'initiative', $ctrl.character.initiative);">
          </md-input-container>
          <md-input-container flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <md-checkbox aria-label="Initiative Lock" class="md-primary inline-checkbox"
            ng-model="$ctrl.character.initiativeLock"
            ng-change="$ctrl.updateCharacter('', 'initiativeLock', $ctrl.character.initiativeLock); $ctrl.getInitiative();">
              <md-icon class="material-icons">
                <span ng-if="$ctrl.character.initiativeLock">
                  lock
                </span>
                <span ng-if="!$ctrl.character.initiativeLock">
                  lock_open
                </span>                
              </md-icon>
            </md-checkbox>
          </md-input-container>
        </div>

        <!--Speed-->
        <div flex="25" flex-sm="50" flex-xs="100" layout="row">
          <md-input-container ng-if="$ctrl.character.speedLock" flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <label>Speed</label>
            <input type="number" ng-model="$ctrl.character.speed" disabled
            ng-change="$ctrl.updateCharacter('', 'speed', $ctrl.character.speed);">
            <md-tooltip md-direction="bottom">
              {{$ctrl.character.race}}
            </md-tooltip>
          </md-input-container>
          <md-input-container ng-if="!$ctrl.character.speedLock" flex="50" flex-sm="50" flex-xs="100" class="md-no-error-spacer">
            <label>Speed</label>
            <input type="number" ng-model="$ctrl.character.speed" step="5"
            ng-change="$ctrl.updateCharacter('', 'speed', $ctrl.character.speed);">
          </md-input-container>
          <md-input-container flex="50" flex-sm="50" flex-xs="50" class="md-no-error-spacer">
            <md-checkbox aria-label="Speed Lock" class="md-primary inline-checkbox"
            ng-model="$ctrl.character.speedLock"
            ng-change="$ctrl.updateCharacter('', 'speedLock', $ctrl.character.speedLock); $ctrl.getSpeed();">
              <md-icon class="material-icons">
                <span ng-if="$ctrl.character.speedLock">
                  lock
                </span>
                <span ng-if="!$ctrl.character.speedLock">
                  lock_open
                </span>                
              </md-icon>
            </md-checkbox>
          </md-input-container>
        </div>       
      </div>
    </md-card-content>
  </md-card>
  <md-card>
    <md-card-content>
      <div layout="row" layout-wrap>
        <!--Current Hit Points-->
        <md-input-container flex="25" flex-sm="100" flex-xs="100" class="md-no-error-spacer">
          <label>Current Hit Points</label>
          <input type="number" ng-model="$ctrl.character.currentHP"
          ng-change="$ctrl.updateCharacter('', 'currentHP', $ctrl.character.currentHP);">
        </md-input-container>

        <!--Max Hit Points-->
        <md-input-container flex="25" flex-sm="100" flex-xs="100" class="md-no-error-spacer">
          <label>Max Hit Points</label>
          <input type="number" ng-model="$ctrl.character.maxHP"
          ng-change="$ctrl.updateCharacter('', 'maxHP', $ctrl.character.maxHP); $ctrl.updateTotalHP()">
        </md-input-container>

        <!--Temp Hit Points-->
        <md-input-container flex="25" flex-sm="100" flex-xs="100" class="md-no-error-spacer">
          <label>Temp Hit Points</label>
          <input type="number" ng-model="$ctrl.character.tempHP"
          ng-change="$ctrl.updateCharacter('', 'tempHP', $ctrl.character.tempHP); $ctrl.updateTotalHP()">
        </md-input-container>

        <!--Total Hit Points-->
        <md-input-container flex="25" flex-sm="100" flex-xs="100" class="md-no-error-spacer">
          <label>Total Hit Points</label>
          <input type="number" ng-model="$ctrl.totalHP" disabled>
          <!--If there are no subraces-->
          <md-tooltip md-direction="bottom">
            Max HP + Temp HP
          </md-tooltip>
        </md-input-container>

        
      </div>
    </md-card-content>
  </md-card>

  <div layout="column" layout-padding>
    <h5 class="no-margin">Ability Scores</h5>
  </div>
  <md-card>
    <md-card-content>
      <md-table-container>
        <table md-table md-progress="promise" ng-cloak>
          <thead md-head md-order="$ctrl.abilityScoreOrder" md-on-reorder="">
            <tr md-row>
              <th md-column md-order-by="name"><span>Name</span></th>
              <th md-column md-numeric class="text-center"><span>Base</span></th>
              <th md-column md-numeric class="text-center"><span>Bonus</span></th>
              <th md-column md-numeric class="text-center"><span>Total</span></th>
              <th md-column md-numeric class="text-center"><span>Modifier</span></th>
            </tr>
          </thead>
          <tbody md-body>
            <tr md-row ng-repeat="abilityScore in $ctrl.abilityScores | orderBy: $ctrl.abilityScoreOrder track by $index">
              <td md-cell>{{abilityScore.name}}</td>
              <td md-cell class="text-center">
                <md-input-container class="no-margin md-no-error-spacer">
                  <span ng-if="abilityScore.name === 'Dexterity'">
                    <input type="number" ng-model="$ctrl.character.abilityScores[abilityScore.name].base"
                    ng-change="$ctrl.updateCharacter('abilityScores/' + abilityScore.name + '/', 'base',
                    $ctrl.character.abilityScores[abilityScore.name].base); $ctrl.getInitiative();"
                    aria-label="ability score bonus" class="text-center">
                  </span>
                  <span ng-if="abilityScore.name !== 'Dexterity'">
                    <input type="number" ng-model="$ctrl.character.abilityScores[abilityScore.name].base"
                    ng-change="$ctrl.updateCharacter('abilityScores/' + abilityScore.name + '/', 'base',
                    $ctrl.character.abilityScores[abilityScore.name].base);"
                    aria-label="ability score bonus" class="text-center">
                  </span>
                </md-input-container>
              </td>
              <td md-cell class="text-center">
                <md-input-container class="no-margin md-no-error-spacer">
                  <span ng-if="abilityScore.name === 'Dexterity'">
                    <input type="number" ng-model="$ctrl.character.abilityScores[abilityScore.name].bonus"
                    ng-change="$ctrl.updateCharacter('abilityScores/' + abilityScore.name + '/', 'bonus',
                    $ctrl.character.abilityScores[abilityScore.name].bonus); $ctrl.getInitiative();"
                    aria-label="ability score bonus">
                  </span>
                  <span ng-if="abilityScore.name !== 'Dexterity'">
                    <input type="number" ng-model="$ctrl.character.abilityScores[abilityScore.name].bonus"
                    ng-change="$ctrl.updateCharacter('abilityScores/' + abilityScore.name + '/', 'bonus',
                    $ctrl.character.abilityScores[abilityScore.name].bonus);"
                    aria-label="ability score bonus">
                  </span>                  
                </md-input-container>
              </td>
              <td md-cell class="text-center">
                {{$ctrl.character.abilityScores[abilityScore.name].base + $ctrl.character.abilityScores[abilityScore.name].bonus}}
              </td>
              <td md-cell class="text-center">
                <span ng-if="$ctrl.character && $ctrl.getAbilityScoreModifier(
                  $ctrl.character.abilityScores[abilityScore.name].base + 
                  $ctrl.character.abilityScores[abilityScore.name].bonus) > 0">+</span>
                  
                <span ng-if="$ctrl.character">
                {{$ctrl.getAbilityScoreModifier(
                  $ctrl.character.abilityScores[abilityScore.name].base + 
                  $ctrl.character.abilityScores[abilityScore.name].bonus)}}
                </span>
              </td>
            </tr>

            <tr md-row md-select="characters" md-select-id="name" md-auto-select ng-if="$ctrl.characters.length === 0">
              <td md-cell colspan="2">No Characters Found</td>
            </tr>

          </tbody>
        </table>
      </md-table-container>
    </md-card-content>
  </md-card>


  <div layout="column" layout-padding>
    <h5 class="no-margin">Skills {{$ctrl.skillOrder}}</h5>
  </div>
  <md-card>
    <md-card-content>
      <md-table-container>
        <table md-table ng-model="$ctrl.selected" md-progress="promise">
          <thead md-head md-order="$ctrl.skillOrder" md-on-reorder="">
            <tr md-row>
              <th md-column md-order-by="name"><span>Name</span></th>
              <!--<th md-column md-numeric md-order-by="abilityScore" hide-xs hide-sm><span>Modifier</span></th>
              <th md-column md-numeric hide-xs><span>Ability Score</span></th>-->
              <th md-column class="text-center"><span>Traning</span></th>
              <th md-column md-numeric class="text-center"><span>Bonus</span></th>
              <th md-column md-numeric class="text-center"><span>Modifier</span></th>
            </tr>
          </thead>
          <tbody md-body>
            <tr md-row ng-repeat="skill in $ctrl.skills | orderBy: $ctrl.skillOrder track by $index">
              <td md-cell>{{skill.name}}</td>
              <!--<td md-cell hide-xs hide-sm>{{skill.abilityScore}}</td>
              <td md-cell  hide-xs>{{$ctrl.character.abilityScores[skill.abilityScore].base +
              $ctrl.character.abilityScores[skill.abilityScore].bonus}}</td>-->
              <td md-cell class="text-center">
                <span>
                  <md-checkbox ng-model="$ctrl.character.skills[skill.name].trained" aria-label="Checkbox 1" class="md-primary"
                  ng-change="$ctrl.updateCharacter('skills/' + skill.name + '/', 'trained', $ctrl.character.skills[skill.name].trained);">
                  </md-checkbox>
                </span>
              </td>
              <td md-cell class="text-center">
                <md-input-container class="no-margin md-no-error-spacer">
                  <input aria-label="skill bonus" ng-model="$ctrl.character.skills[skill.name].bonus" type="number"
                  ng-change="$ctrl.updateCharacter('skills/' + skill.name + '/', 'bonus', $ctrl.character.skills[skill.name].bonus);">
                </md-input-container>
              </td>
              <td md-cell class="text-center">
                <span ng-if="$ctrl.character.skills[skill.name].trained">
                  <span ng-if="$ctrl.getAbilityScoreModifier(
                    $ctrl.character.abilityScores[skill.abilityScore].base + 
                    $ctrl.character.abilityScores[skill.abilityScore].bonus) +
                    $ctrl.character.skills[skill.name].bonus +
                    $ctrl.character.proficiencyBonus  > 0">+</span>
                  {{$ctrl.getAbilityScoreModifier(
                    $ctrl.character.abilityScores[skill.abilityScore].base + 
                    $ctrl.character.abilityScores[skill.abilityScore].bonus) +
                    $ctrl.character.skills[skill.name].bonus +
                    $ctrl.character.proficiencyBonus}}  
                </span>
                <span ng-if="!$ctrl.character.skills[skill.name].trained">
                  <span ng-if="$ctrl.getAbilityScoreModifier(
                    $ctrl.character.abilityScores[skill.abilityScore].base + 
                    $ctrl.character.abilityScores[skill.abilityScore].bonus) +
                    +$ctrl.character.skills[skill.name].bonus > 0">+</span>
                  {{$ctrl.getAbilityScoreModifier(
                    $ctrl.character.abilityScores[skill.abilityScore].base + 
                    $ctrl.character.abilityScores[skill.abilityScore].bonus) +
                    +$ctrl.character.skills[skill.name].bonus}}  
                </span>
              </td>
            </tr>

          </tbody>
        </table>
      </md-table-container>
    </md-card-content>
  </md-card>
</section>